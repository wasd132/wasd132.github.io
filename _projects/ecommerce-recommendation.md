---
layout: project
title: "이커머스 데이터 기반 개인화 추천 시스템"
summary: >
  DACON 이커머스 고객 거래 데이터를 활용하여, Apriori 연관 규칙 마이닝과 LGBMRanker 기반 LTR(Learning to Rank) 모델을 결합한 하이브리드 상품 추천 시스템입니다. 단순한 상품 유사도 기반 추천이 아닌, 고객·상품 특성을 피처로 학습하여 개인화된 추천 순위를 제공합니다.
image: assets/images/raspberry-pi-monitor.png
technologies: [Python, Apriori, LightGBM, LGBMRanker, Pandas, Kaggle]
github:
categories: ml
---

## 개요

대규모 이커머스 환경에서 단순 인기 상품 노출을 넘어, 고객 개개인의 특성과 구매 패턴을 반영한 맞춤형 추천의 필요성이 대두되었습니다. 이를 해결하기 위해 DACON 이커머스 데이터셋을 활용하여, **Apriori 연관 규칙 마이닝과 LTR(Learning to Rank) 알고리즘을 결합한 하이브리드 추천 시스템**을 설계·구현했습니다. 멘토로서 3명의 팀원을 지도하며 데이터 분석 기초부터 머신러닝 파이프라인 구축까지 전 과정을 리드하여 평균 NDCG 0.867의 높은 추천 성능을 달성했습니다.

***

## 주요 성과

- **대회 수상:** T-SUM 데이터 분석/인공지능 경진대회 **최우수상 수상**
- **추천 성능:** LightGBM 기반 LTR 모델로 랭킹 예측 품질 지표인 **NDCG 0.867** 달성
- **알고리즘 최적화:** 지지도 0.004, 신뢰도 0.4 기반의 Apriori 알고리즘으로 **약 45만 개의 유의미한 상품 연관 규칙** 도출
- **리더십:** 10주간 주 1회 세션을 통해 노베이스 멘티 3명을 지도하여 전원 ML 모델링 및 EDA 역량 확보

***

## 하이브리드 추천 시스템 아키텍처

사용자의 과거 구매 이력과 상품 간의 연관성(협업 필터링), 그리고 유저/아이템 메타데이터(콘텐츠 기반)를 모두 학습하는 4단계 랭킹 파이프라인을 구축했습니다.

```text
[Step 1: 연관 규칙 마이닝] ──▶ [Step 2: LTR 학습 데이터 생성] ──▶ [Step 3: 랭킹 모델 학습] ──▶ [Step 4: 개인화 추천]
- Apriori 알고리즘 적용      - 실제 구매 상품: 6점 부여          - LGBMRanker 학습         - 구매 이력 제외
- 향상도(Lift) 기준 정렬     - 유사 상품(Top 5): 5~1점 차등      - Loss: lambdarank        - Top N 랭킹 추출
- ItemSimilar 테이블 생성    - 비관련 상품(3개): 0점 랜덤 샘플링 - NDCG 성능 평가          - 트렌드 기반 보조 추천
```

### 1. 연관 규칙 마이닝 (Apriori)
고객의 장바구니 데이터를 트랜잭션 형태로 변환하여 상품 간 구매 연관성을 도출했습니다. 
- 롱테일(Long-tail) 상품까지 포괄하기 위해 최소 지지도를 0.004로 낮게 설정하여 약 45만 개의 룰을 생성했습니다.
- 단순 동시 구매 횟수(지지도)가 아닌, 두 상품 간의 실질적 연관성을 의미하는 **향상도(Lift)**를 기준으로 상품당 상위 5개의 유사 아이템 풀을 구성했습니다.

### 2. Learning to Rank (LTR) 기반 개인화 랭킹
단순 연관 규칙의 한계(유저 특성 미반영)를 극복하기 위해 머신러닝 랭킹 모델을 도입했습니다.
- **점수 체계 설계:** 모델이 랭킹을 학습할 수 있도록 `구매(6점) > 유사(5~1점) > 무관(0점)`의 타겟 밸류를 직접 레이블링했습니다.
- **피처 엔지니어링:** 고객 피처(성별, 지역, 가입기간)와 상품 피처(카테고리, 평균 금액, 할인율)를 결합하여 개인화 컨텍스트를 부여했습니다.
- **모델링:** 랭킹 최적화에 특화된 **LGBMRanker**를 도입하고 `lambdarank` 손실 함수를 적용하여, 고객별로 가장 클릭 확률이 높은 상품 순위를 예측했습니다.

### 3. 트렌드 기반 Rule-based 보조 추천
신규 가입자(Cold-Start) 및 시즈널리티 반영을 위해 트렌드 점수(월별 판매량 + 재구매율) 기반의 룰베이스 추천을 병행하여 시스템의 커버리지를 넓혔습니다.

***

## 담당 업무 및 멘토링 리더십

### 1. 기술 의사결정 및 프로젝트 방향성 수립
데이터 확보 가능성과 ML 적용 적합성을 검토하여 팀의 연구 주제를 확정했습니다.
- 공공데이터(서울시)와 대회용 데이터(DACON)를 비교 분석한 뒤, 추천 시스템 학습에 필수적인 '유저 식별자'와 '풍부한 메타데이터'가 존재하는 DACON 이커머스 데이터셋으로 최종 결정했습니다.
- 실시간 협업을 위해 VSCode Live Share를 테스트했으나 세션 불안정성 문제를 확인하고, 클라우드 기반의 **Kaggle Notebook**으로 협업 환경을 즉각 전환하여 분석 환경을 표준화했습니다.

<img src="{{ site.baseurl }}/assets/images/vis.jpg" alt="데이터 분석 시각화" style="max-width:601px; width:100%; height:auto;">

### 2. 데이터 분석(EDA) 파이프라인 설계 및 지도
5개로 분할된 관계형 데이터셋(Customer, Sales, Discount, Marketing, Tax)의 분석 프레임워크를 설계하고 멘티들에게 작업을 분배했습니다.
- **인사이트 도출 리드:** "할인율은 3개월 주기로 변동됨", "마케팅 비용과 실제 거래액 간의 상관관계가 미미함", "신규 가입자 중 여성 비율이 압도적임" 등 비즈니스 관점에서 유의미한 패턴을 찾아내도록 분석 방향을 코칭했습니다.

### 3. 추천 알고리즘 튜닝 및 모델 평가 
LightGBM을 활용한 LTR 파이프라인 코어 로직을 직접 구현하고 튜닝했습니다.
- 랭킹 문제에 적합한 평가 지표인 NDCG@k를 도입하여 고객 그룹별 추천 품질을 정량적으로 측정(평균 0.867)했습니다.
- Feature Importance를 시각화하여 '고객의 지역'과 '과거 구매 카테고리'가 추천에 미치는 영향도를 분석하고 이를 최종 발표 자료의 핵심 근거로 활용했습니다.

<img src="{{ site.baseurl }}/assets/images/edu.jpg" alt="멘토링 활동" style="max-width:601px; width:100%; height:auto;">

### 4. 10주간의 체계적인 멘토링
단순히 프로젝트를 리드하는 것을 넘어 팀원들의 실질적인 기술 성장에 집중했습니다.
- 파이썬 기초 문법부터 Pandas 전처리, 시각화(Matplotlib), Weka/Scikit-learn을 활용한 머신러닝 기초까지 주차별 커리큘럼을 직접 구성하여 교육했습니다.
- 최종적으로 12페이지 분량의 심사위원용 발표 자료를 총괄 제작하여 최우수상 수상을 이끌어냈습니다.

***

##  기술 의사결정 및 트러블슈팅

단순한 모델 구현을 넘어, 추천 시스템의 고질적인 문제들을 엔지니어링 관점에서 해결했습니다.

### 1. Long-Tail 상품 추천을 위한 Apriori 파라미터 최적화
- **Situation (상황):** 일반적인 연관 규칙 마이닝(Apriori) 적용 시, 소수의 베스트셀러 상품 규칙만 도출되고 대다수의 비주류 상품(Long-tail)은 추천 풀에서 누락되는 문제가 발생했습니다.
- **Action (행동):** 베스트셀러의 편향을 줄이기 위해 최소 지지도(Support)를 0.004로 대폭 낮춰 규칙 생성 범위를 확장했습니다. 대신, 우연히 같이 구매된 노이즈를 필터링하기 위해 두 아이템 간의 독립성을 통제하는 **향상도(Lift)**를 1차 정렬 기준으로 삼았습니다.
- **Result (결과):** 인기 상품에 편향되지 않은 약 45만 개의 정교한 연관 규칙을 도출하여, 비주류 상품도 유저 취향에 맞게 추천될 수 있는 튼튼한 풀(Pool)을 확보했습니다.

### 2. LTR(Learning to Rank) 훈련을 위한 Labeling 체계 구축
- **Situation (상황):** 확보한 데이터는 "유저가 무엇을 샀다"는 긍정적 암묵적 피드백(Implicit Feedback)만 존재할 뿐, "무엇을 추천해야 하는지"에 대한 명시적 정답지(Label)나 랭킹 점수가 없었습니다.
- **Action (행동):** 추천 시스템이 순위를 학습할 수 있도록 가상의 점수 체계를 설계했습니다. 실제 구매한 상품은 최고점(6점)을, Apriori 향상도 순위에 따른 유사 아이템 5개는 차등 점수(5~1점)를, 무작위 샘플링한 비관련 아이템은 최하점(0점)을 부여하는 **데이터 파이프라인을 구축**했습니다.
- **Result (결과):** Implicit Feedback 데이터만으로도 랭킹 모델(LGBMRanker)을 훈련시킬 수 있는 환경을 마련했으며, 이를 통해 단순 규칙 기반 추천보다 훨씬 정교한 개인화 추천(NDCG 0.867)을 달성했습니다.

### 3. Cold-Start 문제 대응을 위한 듀얼 추천 트랙 도입
- **Situation (상황):** LTR 모델은 과거 구매 이력이 풍부한 기존 고객에게는 높은 정확도를 보였으나, 가입 직후 구매 이력이 없는 신규 가입자(Cold-Start User)에게는 추천을 제공하지 못하는 한계가 있었습니다.
- **Action (행동):** 개인화 모델이 작동할 수 없는 구간을 커버하기 위해, 해당 월의 전체 판매량과 재구매율을 정규화(StandardScaler)하여 점수화하는 **Rule-based 트렌드 추천 로직**을 별도의 트랙으로 개발했습니다.
- **Result (결과):** 신규 고객에게는 트렌드 기반의 인기 상품을, 기존 고객에게는 LTR 기반의 초개인화 상품을 제공하는 하이브리드 추천 구조를 완성하여 전체 유저에 대한 서비스 커버리지를 100%로 끌어올렸습니다.
