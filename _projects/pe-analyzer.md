---
layout: project
title: "PE-A (Analyzer) - PE 파일 분석 도구"
summary: "PE 파일 포맷을 분석하고 디지털 포렌식 분야에서 활용할 수 있는 올인원 도구입니다. 기능별로 파편화된 도구들을 통합하여 초보자도 손쉽게 PE 구조를 분석하고, 패킹 여부 검사, 헥스 편집, PDF 보고서 생성까지 지원합니다."
image: assets/images/mpw.jpg
technologies: [Python, PyQt5, Qt Designer, pefile, ReportLab]
github: https://github.com/ultisy/PE-A
categories: security
---

## 프로젝트 배경

기존 PE 분석 도구들은 기능별로 파편화되어 있어, 분석가가 여러 도구(PEview, HxD, Detect It Easy 등)를 오가며 작업해야 했습니다. 시스템 보안 수업 프로젝트로, 이를 하나로 통합한 올인원 PE 분석 도구를 개발했습니다.

## 데모 영상

<video width="100%" controls>
  <source src="{{ site.baseurl }}/assets/videos/PE-A.mp4" type="video/mp4">
</video>

## 주요 기능

### 1. PE 헤더 파싱
DOS Header, NT Header(File Header + Optional Header), Section Header 정보를 `QTableWidget` 테이블로 시각화합니다. 각 필드의 실제 값과 의미를 함께 표시하여 PE 구조를 한눈에 파악할 수 있습니다.
- **DOS Header**: `e_magic`(MZ 시그니처), `e_lfanew`(NT Header 오프셋)
- **NT Header**: Machine(CPU 아키텍처), TimeDateStamp(컴파일 일시), AddressOfEntryPoint, ImageBase, SectionAlignment 등
- **Section Header**: 각 섹션의 Name, VirtualAddress, SizeOfRawData, Characteristics

### 2. 패킹 여부 검사
섹션 이름을 기반으로 UPX, ASPack, ASProtect, PECompact, Krypton 등 주요 패커의 시그니처를 자동 탐지합니다. 패킹이 감지되면 경고 메시지를 표시하여 추가 분석(언패킹) 필요 여부를 안내합니다.

### 3. 상세 정보 분석
Entry Point, EP Section, File Offset, First 16 Bytes, Linker Info, Subsystem(GUI/Console), Compiler Info를 별도 다이얼로그로 표시합니다. EP 섹션의 첫 바이트를 확인하여 패킹 판별의 보조 지표로 활용할 수 있습니다.

### 4. 헥스 뷰어 & 에디터
바이너리 데이터를 `오프셋 | 헥스 값 | ASCII` 형식으로 표시하며, 특정 헥스 값 검색과 오프셋 지정 편집을 지원합니다. 수정된 데이터는 파일에 직접 반영되어 별도의 헥스 에디터 없이도 바이너리 수정이 가능합니다.

### 5. PDF 분석 보고서 생성
ReportLab을 사용하여 분석 결과를 PDF로 자동 생성합니다. 작성일시, DOS/NT/Section Header 분석 결과, Detail 정보, 컴파일러 참조표가 포함되며 한글 폰트(맑은 고딕)를 지원합니다.

## 시스템 구조

```
main.py              — 진입점 (의존성 자동 설치 후 메인 윈도우 실행)
├── pe_viewer_2_4.py — 메인 UI (PE 헤더 파싱, 패킹 검사, 파일 선택)
├── detail.py        — Entry Point 상세 분석 다이얼로그
├── hex_viewer.py    — 헥스 뷰어/에디터 (검색·수정 기능)
└── pdf_sample.py    — PDF 보고서 생성 (한글 지원)
```
## 기술 스택

- **Python + pefile** — PE 구조 파싱 (DOS/NT/Optional/Section Header, 섹션 권한 분석, `struct` 모듈로 바이너리 언패킹)
- **PyQt5 + Qt Designer** — GUI 데스크톱 앱 (`QMainWindow` + `QDialog` 다중 창, `QTableWidget` 테이블 표시, `QFileDialog` 파일 선택)
- **ReportLab** — PDF 보고서 자동 생성 (한글 폰트 지원, 구조화된 분석 보고서 출력)

## 담당 업무

팀장으로서 **일정·리스크 관리**, **UI/UX 디자인**, **헥스 뷰어 파트 개발**을 담당했습니다.

### 1. 일정·리스크 관리

시스템 보안 수업 프로젝트로 한정된 기간 내에 PE 헤더 파싱, 패킹 검사, 헥스 뷰어, PDF 보고서 등 4개 핵심 기능을 완성해야 했습니다. 팀장으로서 전체 개발 일정을 수립하고, 기능 간 의존 관계를 고려하여 작업 순서를 조율했습니다.

- 기능별 담당자를 배정한 뒤, **PE 헤더 파싱 → 패킹 검사 → 상세 정보 → 헥스 뷰어 → PDF 보고서** 순으로 개발 우선순위를 설정했습니다. 헥스 뷰어와 PDF 보고서는 헤더 파싱 결과에 의존하지 않으므로 병렬 개발이 가능한 구간을 식별하여 동시에 진행했습니다.
- 개발 중반에 `pefile` 라이브러리가 일부 변형된 PE 파일(패킹된 악성코드 샘플 등)에서 `PEFormatError`를 발생시키는 문제를 발견했습니다. 이 문제가 전체 앱의 안정성에 영향을 주는 리스크로 판단하여, 예외 처리를 최우선 과제로 격상하고 담당자에게 즉시 대응을 요청했습니다. 그 결과 PE 형식이 아닌 파일도 헥스 뷰어로는 접근 가능하도록 예외 처리가 완료되어, 프로그램 비정상 종료 없이 모든 바이너리 파일을 다룰 수 있게 되었습니다.
- 매주 팀 미팅에서 각 기능의 진행 상황을 점검하고, 지연 사항이 있으면 작업 범위를 조정하거나 담당자 간 업무를 재분배하여 발표 기한에 맞춰 전체 기능을 완성했습니다.

### 2. UI/UX 디자인: Qt Designer 기반 화면 설계

<img src="{{ site.baseurl }}/assets/images/ui.png" alt="UI/UX 디자인 설계" width="100%">

초보 분석가도 쉽게 사용할 수 있는 직관적 인터페이스를 목표로, **Qt Designer**를 활용하여 전체 앱의 UI/UX를 설계했습니다.

- 기존 PE 분석 도구들(PEview, HxD, Detect It Easy)의 화면 구성을 조사한 뒤, 사용자가 하나의 창에서 **파일 선택 → 헤더 분석 → 상세 정보 → 헥스 뷰어 → PDF 보고서**까지 순차적으로 접근할 수 있는 원클릭 워크플로우를 설계했습니다.
- PE 헤더를 테이블로 시각화하고, 상세 정보와 헥스 뷰어는 별도의 다중 창으로 분리하여 화면이 복잡해지지 않으면서도 필요할 때 즉시 열 수 있도록 했습니다.
- 패킹이 감지된 경우 빨간색 경고 메시지를 표시하고, 각 버튼(Detail, HEX, PDF)을 상단에 배치하여 분석 단계별로 자연스럽게 이동할 수 있는 흐름을 구성했습니다.
- Qt Designer에서 `.ui` 파일로 화면을 먼저 프로토타이핑한 뒤, 팀원들의 피드백을 반영하여 레이아웃을 수정하고 최종 디자인을 확정했습니다.

### 3. 헥스 뷰어 파트 개발

파편화된 분석 도구 문제를 해결하기 위해, 별도의 헥스 에디터(HxD) 없이도 바이너리를 확인·수정할 수 있는 **헥스 뷰어 & 에디터**(`hex_viewer.py`)를 직접 개발했습니다.

- 파일을 바이너리 모드(`rb`)로 읽어 **오프셋 | 헥스 값 | ASCII** 3단 형식으로 출력하는 뷰어를 구현했습니다. 각 행은 16바이트 단위로 표시하며, 출력 불가능한 문자는 `.`으로 치환하여 가독성을 확보했습니다.
- **헥스 값 검색 기능**을 구현하여, 사용자가 특정 바이트 패턴(예: `4D 5A`, `50 45`)을 입력하면 파일 전체에서 해당 패턴의 오프셋 위치를 찾아 표시하도록 했습니다. 이를 통해 MZ 시그니처나 PE 시그니처의 위치를 빠르게 확인할 수 있습니다.
- **오프셋 지정 편집 기능**을 추가하여, 수정할 오프셋 주소와 16진수 데이터를 입력하면 `file.seek()` → `file.write()`로 파일에 직접 반영되도록 구현했습니다. 예를 들어, 패킹된 파일의 Entry Point 바이트를 수정하거나 섹션 헤더의 Characteristics 플래그를 변경하는 작업을 별도 도구 없이 수행할 수 있습니다.
- PE 형식이 아닌 파일을 로드했을 때에도 헥스 뷰어만은 정상 작동하도록 예외 분기를 구현하여, 모든 바이너리 파일의 원시 데이터를 확인할 수 있게 했습니다.

### 4. QA 및 디버깅

각 팀원이 개발한 기능을 통합하는 과정에서 발생하는 버그와 예외 상황을 검증하고, 문제 발생 시 원인을 추적하여 수정하는 역할 또한 담당했습니다.

- 팀원이 개발한 PE 헤더 파싱 기능과 패킹 검사 기능이 통합될 때, 특정 PE 파일에서 섹션 이름이 NULL 바이트를 포함하여 `QTableWidget`에 빈 셀로 표시되는 문제를 발견했습니다. 디버깅을 통해 `pefile`이 반환하는 섹션 이름을 `decode('utf-8', errors='replace')`로 처리하지 않아 발생한 문제임을 확인하고, 해당 코드를 수정하여 모든 섹션 이름이 정상 출력되도록 했습니다.
- PDF 보고서 생성 기능에서 한글이 포함된 분석 결과가 깨지는 문제가 보고되었을 때, ReportLab의 폰트 등록 과정을 추적하여 맑은 고딕 폰트 경로가 환경에 따라 달라지는 것이 원인임을 파악하고, 폰트 파일을 프로젝트에 포함시켜 경로 의존성을 제거했습니다.
- 각 기능(헤더 파싱, 상세 정보, 헥스 뷰어, PDF 보고서)을 다양한 PE 파일 샘플(정상 실행 파일, UPX 패킹 파일, 비PE 파일)로 테스트하는 검증 시나리오를 작성하고, 기능 통합 시마다 해당 시나리오를 반복 수행하여 회귀 버그를 방지했습니다.
- `pefile.PEFormatError` 예외가 앱 전체를 종료시키는 치명적 버그를 발견한 뒤, try-except 블록으로 감싸 경고 메시지를 표시하면서도 헥스 뷰어 기능은 계속 사용할 수 있도록 예외 흐름을 설계했습니다.

## 프로젝트를 진행하며 발생했던 문제들과 해결과정

### 1. PE 포맷 오류 처리
**문제**: PE 형식이 아닌 파일(텍스트, 이미지 등)을 로드하면 `pefile.PEFormatError`가 발생하여 프로그램이 종료되었습니다.<br>
**해결**: 예외 처리로 경고 메시지를 표시하되, "HEX 값은 확인 가능합니다"라는 안내와 함께 헥스 뷰어로는 접근 가능하도록 처리하여 비PE 바이너리도 분석할 수 있게 했습니다.

### 2. 파편화된 분석 도구 통합
**문제**: PE 구조 분석(PEview), 헥스 편집(HxD), 패킹 검사(Detect It Easy), 보고서 작성을 각각 다른 도구로 수행해야 하여 분석 흐름이 끊어졌습니다.<br>
**해결**: 하나의 GUI에 모든 기능을 통합하여 파일 로드 한 번으로 헤더 분석 → 상세 정보 → 헥스 뷰어 → PDF 보고서까지 원클릭으로 접근할 수 있는 워크플로우를 구현했습니다.

### 3. 헥스 에디터 구현
**문제**: 단순 헥스 뷰어는 읽기만 가능하여, 패킹된 파일의 특정 바이트를 수정하려면 별도의 헥스 에디터가 필요했습니다.<br>
**해결**: 오프셋 주소와 16진수 데이터를 입력하면 `file.seek()` → `file.write()`로 파일에 직접 반영되도록 편집 기능을 추가하여, 뷰어와 에디터를 하나의 창에서 처리할 수 있게 했습니다.

### 4. 의존성 자동 관리
**문제**: PyQt5, pefile, reportlab 등 외부 라이브러리 미설치 시 ImportError로 초보 사용자가 실행하지 못하는 문제가 있었습니다.<br>
**해결**: `main.py`에서 `__import__()`로 모듈 존재 여부를 확인하고, 없으면 `subprocess`로 pip 자동 설치를 수행하여 Python만 설치되어 있으면 바로 실행 가능하도록 했습니다.
